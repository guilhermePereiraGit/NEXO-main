<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P√°gina de Aprova√ß√£o NEXO</title>
    <link rel="stylesheet" href="./css/tecnico-novo.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="carregarDadosUsuario(), carregarDadosModelo(), carregarDadosAprovados(), gerarGraficoLinha()">
    <div class="tudo">
        <header>
            <div class="header-container">
                <!-- MENU -->
                <div class="header-menu">
                    <div class="menu" id="menu" onclick="abrirMenu()">
                        <i class="bi bi-list" id="icone"></i>
                    </div>
                </div>

                <!-- NAVEGA√á√ÉO -->
                <div class="header-navigation">
                    <div class="icones">
                        <div class="cadastrar-totens">
                            <div class="fundo" id="fundo2" style="display: none;"></div>
                            <i class="bi bi-display" onclick="ativar('fundo2');irPara('cadastrar-totens')"
                                id="second"></i>
                        </div>
                        <div class="dashboard">
                            <div class="fundo" id="fundo3" style="display: none;"></div>
                            <i class="bi bi-graph-up" onclick="ativar('fundo3');irPara('dashboard')" id="third"></i>
                        </div>
                        <div class="dashboard-agenda">
                            <div class="fundo" id="fundo4" style="display: none;"></div>
                            <i class="bi bi-calendar3" onclick="ativar('fundo4');irPara('dashboard-agenda')"
                                id="fourth"></i>
                        </div>
                    </div>
                    <div class="sair">
                        <div class="fundo" style="display: none;"></div>
                        <i class="bi bi-box-arrow-left" onclick="ativarPopup()"></i>
                    </div>
                </div>
            </div>
            <div class="menu-extend" style="display: none;" id="extend">
                <div class="infos-user">
                    <h1>Guilherme Barros</h1>
                    <h2>T√©cnico de Opera√ß√µes</h2>
                </div>
                <div class="widgets">
                    <p>Caso se depare com algum problema, entre em contato via:</p>
                    <div class="email" style="margin-top: 20px;">
                        <i class="bi bi-envelope"></i>
                        <p>nexo.sptech@gmail.com</p>
                    </div>
                    <div class="telefone" style="margin-top: 20px;">
                        <i class="bi bi-telephone"></i>
                        <p>Telefone: +55(11)98802-2449</p>
                    </div>
                </div>
                <div class="jira-slack">
                    <div class="card-jira-slack"
                        onclick="window.location.href = 'https://nexoadm.atlassian.net/jira/servicedesk/projects/NEXO/summary?ignoreStickyVersion=true'">
                        <img src="assets/imgs/icon-jira.png">
                        <h1>Jira</h1>
                    </div>
                    <div class="card-jira-slack"
                        onclick="window.location.href = 'https://app.slack.com/client/T09LFRM7PFX/C09LH8XJS22'">
                        <img src="assets/imgs/icon-slack.png">
                        <h1>Slack</h1>
                    </div>
                </div>
            </div>
        </header>
        <!-- POPUP DE LOGOUT -->
        <div class="popup-logout" style="display: none;" id="popup-logout">
            <div class="popup-content">
                <i class="bi bi-x-lg" onclick="fecharPopup()"></i>
                <h1>Deseja Sair?</h1>
                <div class="box-button">
                    <button>Fazer Logout</button>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="information">
                <h2 style="margin-left: 70px;">Tela T√©cnico</h2>
            </div>
            <!-- CADASTRO TOTENS -->
            <div class="box" id="box">
                <div class="cadastrar-totens" id="cadastrar-totens">
                    <div id="segundo">
                        <div class="more" id="more">
                            <h1 style="margin-bottom: 0px;">Totens Cadastrados</h1>
                            <button onclick="abrirPopupTotem()">Adicionar Totem</button>
                        </div>
                        <div class="aprovados" id="div_aprovados"></div>
                    </div>
                    <div class="popuptotem" id="popuptotem">
                        <div class="card">
                            <div class="cima">
                                <h1>Cadastro de Totem</h1>
                                <button onclick="fecharPopupTotem()"><img src="assets/imgs/close.png"></button>
                            </div>
                            <div class="baixo" id="baixo"></div>
                            <div class="item-card">
                                <div class="item-card">
                                    <label for="input_cep">Cep:</label>
                                    <input type="text" id="input_cep" placeholder="CEP" value="00222-333">
                                </div>
                                <div class="item-card" id="estado">
                                    <label>Estado:</label>
                                    <select name="estado_atuacao" id="estado_atuacao"
                                        onchange="atualizarCampos()"></select>
                                </div>
                            </div>
                            <div class="item-card">
                                <div class="item-card" id="regioes">
                                    <label>Regi√£o:</label>
                                    <select name="regiao_atuacao" id="regiao_atuacao"
                                        onchange="procurarZonas()"></select>
                                </div>
                                <div class="item-card" id="zonas">
                                    <label>Zona:</label>
                                    <select name="zona_atuacao" id="zona_atuacao"></select>
                                </div>
                            </div>
                            <div class="item-card">
                                <div class="item-card">
                                    <label for="input_cidade">Cidade:</label>
                                    <input type="text" id="input_cidade" placeholder="Cidade" value="S√£o Paulo">
                                </div>
                                <div class="item-card">
                                    <label for="input_rua">Rua:</label>
                                    <input type="text" id="input_rua" placeholder="Rua" value="Rua Tavares">
                                </div>
                                <div class="item-card">
                                    <label for="input_bairro">Bairro:</label>
                                    <input type="text" id="input_bairro" placeholder="Bairro" value="Jardins">
                                </div>
                            </div>
                            <div class="item-card">
                                <div class="item-card">
                                    <label for="input_complemento">Complemento:</label>
                                    <input type="text" id="input_complemento" placeholder="Complemento" value="Loja1">
                                </div>
                                <div class="item-card">
                                    <label for="input_numero">N√∫mero:</label>
                                    <input type="number" id="input_numero" placeholder="N¬∞" value="34">
                                </div>
                            </div>
                            <div class="part-dois">
                                <div class="item-card">
                                    <label for="input_modelos">Qual o modelo?</label>
                                    <select name="modelos" id="input_modelos">
                                        <option value="">Selecione uma op√ß√£o</option>
                                    </select>
                                </div>
                                <div class="item-card">
                                    <label for="input_qtd_de_totens">Quantos totens nesse local?</label>
                                    <input type="number" id="input_qtd_de_totens" oninput="atualizarTotens()"
                                        placeholder="N¬∞">
                                </div>
                            </div>
                            <div class="totens-scroll" id="totens"></div>
                            <div class="part-dois">
                                <button class="cadastrar" onclick="adicionarMaisUmTotem()">Adicionar Totem</button>
                                <button class="cadastrar" onclick="cadastrarEndereco()">Cadastrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- DASHBOARD -->
            <div class="dashboard" id="dashboard">
                <div class="kpis">
                    <div class="kpi">
                        <div class="titulo">
                            <h1>Estabilidade</h1>
                            <h2>da Regi√£o</h2>
                        </div>
                        <div class="dado">
                            <h1>85%</h1>
                            <h2>Vari√¢ncia: 5 pontos</h2>
                        </div>
                    </div>
                    <div class="kpi">
                        <div class="titulo">
                            <h1>Estabilidade</h1>
                            <h2>da Regi√£o</h2>
                        </div>
                        <div class="dado">
                            <h1>85%</h1>
                            <h2>Vari√¢ncia: 5 pontos</h2>
                        </div>
                    </div>
                    <div class="kpi">
                        <div class="titulo">
                            <h1>Estabilidade</h1>
                            <h2>da Regi√£o</h2>
                        </div>
                        <div class="dado">
                            <h1>85%</h1>
                            <h2>Vari√¢ncia: 5 pontos</h2>
                        </div>
                    </div>
                    <div class="kpi">
                        <div class="titulo">
                            <h1>Estabilidade</h1>
                            <h2>da Regi√£o</h2>
                        </div>
                        <div class="dado">
                            <h1>85%</h1>
                            <h2>Vari√¢ncia: 5 pontos</h2>
                        </div>
                    </div>
                </div>
                <div class="dados">
                    <div class="modelos">
                        <div class="legenda">
                            <div class="barra-legenda">
                                <div class="item ione">20%</div>
                                <div class="item itwo">40%</div>
                                <div class="item ithree">60%</div>
                                <div class="item ifour">100%</div>
                            </div>
                            <p>% de Totens em Alerta</p>
                        </div>
                        <div class="list-modelos">
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                            <div class="Totem">
                                <p>Totem AA0385</p>
                                <div class="color"></div>
                            </div>
                        </div>
                    </div>
                    <div class="grafico">
                        <canvas id="grafico-linha" class="chart-container"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
</body>
<script>

    function carregarDadosUsuario() {
        nome = sessionStorage.getItem("NOME_USUARIO");
        email = sessionStorage.getItem("EMAIL_USUARIO")
        lbl_nome.innerHTML = nome;
        lbl_email.innerHTML = email;
    }

    function ativar(escolha) {
        document.getElementById(escolha).style.display = 'block';
        document.getElementById(escolha).style.animation = 'expandirEsquerda 0.5s ease forwards';
        if (escolha == "fundo2") {
            document.getElementById('fundo3').style.animation = 'recolherDireita 0.5s ease forwards';
            document.getElementById('fundo4').style.animation = 'recolherDireita 0.5s ease forwards';
            document.getElementById('second').style.color = "#451c8b";
            document.getElementById('third').style.color = "white";
            document.getElementById('fourth').style.color = "white";

        } else if (escolha == "fundo3") {
            document.getElementById('fundo2').style.animation = 'recolherDireita 0.5s ease forwards';
            document.getElementById('fundo4').style.animation = 'recolherDireita 0.5s ease forwards';
            document.getElementById('second').style.color = "white";
            document.getElementById('fourth').style.color = "white";
            document.getElementById('third').style.color = "#451c8b";
            document.getElementById('box').style.display = "none";;

        } else if (escolha == "fundo4") {
            document.getElementById('fundo2').style.animation = 'recolherDireita 0.5s ease forwards';
            document.getElementById('fundo3').style.animation = 'recolherDireita 0.5s ease forwards';
            document.getElementById('second').style.color = "white";
            document.getElementById('third').style.color = "white";
            document.getElementById('fourth').style.color = "#451c8b";
            document.getElementById('box').style.display = "none";
        }
    }

    aprovados = [];
    function carregarDadosAprovados() {
        var idEmpresa = sessionStorage.getItem("FK_EMPRESA");

        fetch("/totem/verificarAprovados", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idEmpresaServer: idEmpresa
            }),
        }).then(function (resposta) {
            console.log(resposta);

            if (resposta.ok) {
                resposta.json().then(data => {
                    console.log(data);
                    aprovados = data;
                    if (aprovados.length > 0) {
                        gerarCardTotens();
                    } else {
                        nadaPorAquiModelos();
                    }
                })
            } else {
                console.log("Erro ao Buscar Dados!");
            }
        });
    }

    function nadaPorAquiModelos() {
        div_aprovados.innerHTML = `
        <div class="card-nothing">
                <h1>Sem Registros</h1>
                <p>Caso isto n√£o seja o esperado pelo nosso sistema, considere entrar em contato com nossa equipe de suporte</p>
                <p>Estamos √† sua disposi√ß√£o para solucionar seus incidentes e tornar sua experi√™ncia verdadeiramente NEXO.</p>
            </div>
        `;
    }


    function gerarCardTotens() {
        for (var i = 0; i < aprovados.length; i++) {
            var ativo = aprovados[i].status === "ATIVO";

            var ativarDisabled = ativo ? "disabled" : "";
            var desativarDisabled = ativo ? "" : "disabled";

            var ativarStyle = ativo
                ? "background-color: #a5d6a7; cursor: not-allowed; opacity: 0.6;"
                : "background-color: #4caf50; cursor: pointer;";
            var desativarStyle = ativo
                ? "background-color: #f44336; cursor: pointer;"
                : "background-color: #ef9a9a; cursor: not-allowed; opacity: 0.6;";

            div_aprovados.innerHTML += `
        <div class="card-user">
            <div class="card-first">
                <div class="labels"><label id="first">Endere√ßo MAC:</label><label class="label-item">${aprovados[i].numMAC}</label></div>
            </div>
            <div class="card-second">
                <div class="labels"><label id="first">Status:</label><label class="label-item"><b>${aprovados[i].status}</b></label></div>
                <div class="labels"><label id="first">Modelo:</label><label class="label-item">${aprovados[i].nome}</label></div>
            </div>
            <div class="card-second">
                <div class="buttons">
                    <button class="ativar" style="${ativarStyle}" ${ativarDisabled} onclick="modificarStatusTotem(${aprovados[i].idTotem}, 'ativar')">Ativar</button>
                    <button class="desativar" style="${desativarStyle}" ${desativarDisabled} onclick="modificarStatusTotem(${aprovados[i].idTotem}, 'desativar')">Desativar</button>
                </div>
            </div>
        </div>
        `;
        }
    }

    /*Usando*/
    let numeroTotens = 0;
    var modelos = []
    function carregarDadosModelo() {
        idEmpresa = sessionStorage.getItem("FK_EMPRESA");

        fetch("/modelo/buscarModelos", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fkEmpresaServer: idEmpresa
            }),
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json();
                } else {
                    throw new Error("Erro na resposta do servidor");
                }
            })
            .then(dados => {
                for (let i = 0; i < dados.length; i++) {
                    modelos.push(dados[i]);
                }
            })
            .catch(erro => {
                console.log(`#ERRO: ${erro}`);
            });
    }

    function abrirPopupTotem() {
        var options = ''
        for (var i = 0; i < modelos.length; i++) {
            options += `<option value='${modelos[i].IdModelo}'>${modelos[i].Nome}</option>`
        }

        input_modelos.innerHTML += options

        document.getElementById("popuptotem").style.display = "flex";
        document.getElementById("more").style.display = "none";

        carregarEstados();
    }

    function fecharPopupTotem() {
        document.getElementById("popuptotem").style.display = "none";
        window.location.reload();
    }

    function atualizarTotens() {
        const qtdTotens = Number(document.getElementById("input_qtd_de_totens").value);
        const container = document.getElementById("totens");

        container.innerHTML = "";
        numeroTotens = qtdTotens;

        if (qtdTotens <= 0 || isNaN(qtdTotens)) return;

        for (let i = 1; i <= qtdTotens; i++) {
            const divTotem = document.createElement("div");
            divTotem.classList.add("linha-totem");

            const novoInput = document.createElement("input");
            novoInput.type = "text";
            novoInput.id = `totem${i}`;
            novoInput.placeholder = `MAC ADDRESS ${i}`;

            const botaoLixeira = document.createElement("button");
            botaoLixeira.classList.add("botao-lixeira");
            botaoLixeira.innerHTML = "üóëÔ∏è";
            botaoLixeira.onclick = function () {
                removerTotem(divTotem);
            };

            divTotem.appendChild(novoInput);
            divTotem.appendChild(botaoLixeira);
            container.appendChild(divTotem);
        }
    }

    function adicionarMaisUmTotem() {
        const container = document.getElementById("totens");
        numeroTotens++;

        const divTotem = document.createElement("div");
        divTotem.classList.add("linha-totem");

        const novoInput = document.createElement("input");
        novoInput.type = "text";
        novoInput.id = `totem${numeroTotens}`;
        novoInput.placeholder = `MAC ADDRESS ${numeroTotens}`;

        const botaoLixeira = document.createElement("button");
        botaoLixeira.classList.add("botao-lixeira");
        botaoLixeira.innerHTML = "üóëÔ∏è";
        botaoLixeira.onclick = function () {
            removerTotem(divTotem);
        };

        divTotem.appendChild(novoInput);
        divTotem.appendChild(botaoLixeira);
        container.appendChild(divTotem);

        document.getElementById("input_qtd_de_totens").value = numeroTotens;
    }

    function removerTotem(divTotem) {
        divTotem.remove();

        numeroTotens--;
        const inputs = document.querySelectorAll("#totens input");
        inputs.forEach((input, i) => {
            input.id = `totem${i + 1}`;
            input.placeholder = `MAC ADDRESS ${i + 1}`;
        });

        document.getElementById("input_qtd_de_totens").value = numeroTotens;
    }

    var estados = []
    function carregarEstados() {
        fetch("/endereco/buscarEstados", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {

                if (resposta.ok) {
                    resposta.json().then(data => {
                        estados = data;
                        plotarEstadosSelect(estados)
                    })
                } else {
                    console.log("Erro ao Buscar Dados!");
                }
            });
    }

    function plotarEstadosSelect(estados) {
        var option = `<option value="">Selecione uma op√ß√£o</option>`;

        for (var i = 0; i < estados.length; i++) {
            option += `<option value="${estados[i].IdEstado}">${estados[i].Nome}</option>`;
        }

        estado_atuacao.innerHTML = option;
    }

    /*Usando*/
    var regioes = [];
    function atualizarCampos() {
        const estado = estado_atuacao.value;

        fetch("/endereco/buscarRegioes", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEstadoServer: estado
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(data => {
                        console.log(data);
                        regioes = data;
                        plotarRegioesSelect(regioes);
                    })
                } else {
                    console.log("Erro ao Buscar Dados!");
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    function plotarRegioesSelect(regioes) {
        var option = `<option value="">Selecione uma op√ß√£o</option>`;

        for (var i = 0; i < regioes.length; i++) {
            option += `<option value="${regioes[i].IdRegiao}">${regioes[i].Nome}</option>`;
        }

        regiao_atuacao.innerHTML = option;
    }

    var zonas = []
    function procurarZonas() {

        var selectRegiao = document.getElementById("regiao_atuacao");
        var labelSelecionada = selectRegiao.options[selectRegiao.selectedIndex].text;
        const regiao = regiao_atuacao.value;

        fetch("/endereco/buscarZonas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idRegiaoServer: regiao
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(data => {
                        zonas = data;
                        if (zonas.length > 0) {
                            plotarZonasSelect(zonas);
                        } else {
                            zona_atuacao.innerHTML = "";
                        }
                    })
                } else {
                    console.log("Erro ao Buscar Dados!");
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

    }

    function plotarZonasSelect(zonas) {
        var option = `<option value="">Selecione uma op√ß√£o</option>`;

        for (var i = 0; i < zonas.length; i++) {
            option += `<option value="${zonas[i].IdZona}">${zonas[i].Nome}</option>`;
        }

        zona_atuacao.innerHTML = option;
    }

    async function cadastrarEndereco() {
        var cep = input_cep.value;
        var regiaoAtuacao = regiao_atuacao.value;
        var zonaAtuacao = zona_atuacao.value;
        var bairro = input_bairro.value;
        var cidade = input_cidade.value;
        var rua = input_rua.value;
        var numero = input_numero.value;
        var complemento = input_complemento.value;

        await fetch("/endereco/cadastrarEnderecoTotem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                cepServer: cep,
                regiaoAtuacaoServer: regiaoAtuacao,
                zonaAtuacaoServer: zonaAtuacao,
                bairroServer: bairro,
                cidadeServer: cidade,
                ruaServer: rua,
                numeroServer: numero,
                complementoServer: complemento
            }),
        })
            .then(resposta => {
                if (!resposta.ok) {
                    throw new Error("Erro na resposta do servidor");
                }
                return resposta.json();
            })
            .then(dados => {
                let idEndereco;
                if (dados.idEndereco) {
                    idEndereco = dados.idEndereco;
                } else if (dados.retornoIdEndereco && dados.retornoIdEndereco.length > 0) {
                    idEndereco = dados.retornoIdEndereco[0].idEndereco;
                }
                if (idEndereco) {
                    cadastrarTotem(idEndereco);
                } else {
                    console.error("N√£o foi poss√≠vel obter o ID do endere√ßo.");
                }
            })
            .catch(erro => {
                console.log(`#ERRO: ${erro}`);
            });
    }

    function cadastrarTotem(idEndereco) {
        console.log("cadastrooooooo", idEndereco)
        var modelo = input_modelos.value;
        var enderecosMac = [];
        var endereco = idEndereco;

        for (let i = 1; i <= numeroTotens; i++) {
            const macAddress = document.getElementById(`totem${i}`).value;
            enderecosMac.push(macAddress)
        }

        var mensagem = ''
        if (enderecosMac.length > 1) {
            mensagem = 'Totens cadastrados com sucesso!'
        } else {
            mensagem = 'Totem cadastrado com sucesso!'
        }

        fetch("/totem/cadastrarTotem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                modeloServer: modelo,
                enderecosMacServer: enderecosMac,
                fkEnderecoServer: endereco
            }),
        })
            .then(resposta => {
                if (resposta.status == 200) {
                    alert("Cadastro realizado com sucesso!");
                    window.location.reload();
                } else {
                    throw new Error("Erro na resposta do servidor");
                }
            })
            .catch(erro => {
                console.log(`#ERRO: ${erro}`);
            });
    }

    function modificarStatusTotem(idTotem, acao) {
        fetch("/totem/modificarStatusTotem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idTotemServer: idTotem,
                acaoServer: acao
            }),
        })
            .then(resposta => {
                if (resposta.status == 200) {
                    if (acao == "ativar") {
                        alert("Totem ativado com sucesso!");
                        window.location.reload()
                    } else {
                        alert("Totem desativado com sucesso!");
                        window.location.reload()
                    }

                } else {
                    throw new Error("Erro na resposta do servidor");
                }
            })
            .catch(erro => {
                console.log(`#ERRO: ${erro}`);
            });
    }

    var estados = []
    function carregarEstados() {
        fetch("/endereco/buscarEstados", {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (resposta) {

                if (resposta.ok) {
                    resposta.json().then(data => {
                        estados = data;
                        plotarEstadosSelect(estados)
                    })
                } else {
                    console.log("Erro ao Buscar Dados!");
                }
            });
    }

    function plotarEstadosSelect(estados) {
        var option = `<option value="">Selecione uma op√ß√£o</option>`;

        for (var i = 0; i < estados.length; i++) {
            option += `<option value="${estados[i].IdEstado}">${estados[i].Nome}</option>`;
        }

        estado_atuacao.innerHTML = option;
    }

    var regioes = [];
    function atualizarCampos() {
        var selectEstado = document.getElementById("estado_atuacao");
        var labelSelecionada = selectEstado.options[selectEstado.selectedIndex].text;
        const estado = estado_atuacao.value;
        const regiaoContainer = regioes;
        const zonaContainer = zonas;

        fetch("/endereco/buscarRegioes", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idEstadoServer: estado
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(data => {
                        console.log(data);
                        regioes = data;
                        plotarRegioesSelect(regioes);
                    })
                } else {
                    console.log("Erro ao Buscar Dados!");
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    function plotarRegioesSelect(regioes) {
        var option = `<option value="">Selecione uma op√ß√£o</option>`;

        for (var i = 0; i < regioes.length; i++) {
            option += `<option value="${regioes[i].IdRegiao}">${regioes[i].Nome}</option>`;
        }

        regiao_atuacao.innerHTML = option;
    }

    var zonas = []
    function procurarZonas() {

        var selectRegiao = document.getElementById("regiao_atuacao");
        var labelSelecionada = selectRegiao.options[selectRegiao.selectedIndex].text;
        const regiao = regiao_atuacao.value;

        fetch("/endereco/buscarZonas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idRegiaoServer: regiao
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(data => {
                        zonas = data;
                        if (zonas.length > 0) {
                            plotarZonasSelect(zonas);
                        } else {
                            zona_atuacao.innerHTML = "";
                        }
                    })
                } else {
                    console.log("Erro ao Buscar Dados!");
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

    }
    /*Usando*/
    function gerarGraficoLinha() {
        const linha = document.getElementById('grafico-linha');
        new Chart(linha, {
            type: 'line',
            data: {
                labels: ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado', 'Domingo'],
                datasets: [
                    {
                        label: 'Aten√ß√£o',
                        data: [10, 15, 5, 10, 13, 20, 15],
                        borderColor: '#fada64',
                        tension: 0.4
                    },
                    {
                        label: 'Perigoso',
                        data: [5, 2, 7, 12, 3, 6, 9],
                        borderColor: '#f98a25',
                        tension: 0.4
                    },
                    {
                        label: 'Cr√≠tico',
                        data: [1, 2, 1, 4, 2, 3, 1],
                        borderColor: '#ff3131',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Chart.js Line Chart'
                    }
                }
            },
        });
    }

    function plotarZonasSelect(zonas) {
        var option = `<option value="">Selecione uma op√ß√£o</option>`;

        for (var i = 0; i < zonas.length; i++) {
            option += `<option value="${zonas[i].IdZona}">${zonas[i].Nome}</option>`;
        }

        zona_atuacao.innerHTML = option;
    }

    /*Usando*/
    function irPara(escolhida) {
        $("#perfil, #cadastrar-totens, #dashboard", "dashboard-agenda").stop().animate({ opacity: 0 }, 200, function () {
            $(this).css("display", "none");
        });
        $("#" + escolhida).css({ display: "block", opacity: 0 }).stop().animate({ opacity: 1 }, 300);
        carregarDados();
    }
    /*Usando*/
    function abrirMenu() {
        menu_icon = document.getElementById('icone');
        menu = document.querySelector('.menu-extend');
        if (menu_icon.classList.contains("bi-list")) {
            console.log("entrei");
            document.getElementById('extend').style.display = "flex";
            menu.style.animation = "expandirDireita 0.5s ease forwards";
            menu_icon.classList.remove("bi-list");
            menu_icon.classList.add("bi-x-lg")

        } else {
            menu.style.animation = "recolherEsquerda 0.5s ease forwards";
            menu_icon.classList.remove("bi-x-lg");
            menu_icon.classList.add("bi-list")
        }
    }
    /*Usando*/
    function ativarPopup() {
        popup = $("#popup-logout");
        popup.css({ display: "flex", opacity: 0, "pointer-events": "auto" }).animate({ opacity: 1 }, 300);
    }
    /*Usando*/
    function fecharPopup() {
        popup = $("#popup-logout");
        popup.css({ display: "flex", opacity: 0, "pointer-events": "none" }).animate({ opacity: 0 }, 300);
    }

    function abrirEscolha() {
        popup = $("#popup-escolha");
        popup.css({ display: "flex", opacity: 0, "pointer-events": "auto" }).animate({ opacity: 1 }, 300);
    }
    function fecharEscolha() {
        popup = $("#popup-escolha");
        popup.css({ display: "flex", opacity: 0, "pointer-events": "none" }).animate({ opacity: 0 }, 300);
    }

</script>

</html>