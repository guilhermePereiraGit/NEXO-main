<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Aprovação NEXO</title>
    <link rel="stylesheet" href="./css/institucional.css">
    <link rel="stylesheet" href="./css/style_aprovacao.css">
    <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./css/gestao.css">
</head>

<body onload="carregarDadosModelo()">
    <div id="cabecalho">
        <div class="cabecalho-container">
            <div class="logo"><a href="index.html"><img id="logo" src="./assets/imgs/Nexo-Logo.png" alt="Nexo-Logo"></a>
            </div>
            <div class="cabecalho-links" id="cabecalhoLinks">
                <a href="#segundo">Tótens Cadastrados</a>
                <a href="login.html" class="botao-secundario" id="cadastro">Sair</a>
            </div>
        </div>
    </div>
    <div class="pg-principal">
        <div id="segundo">
            <div class="more">
                <h1 style="margin-bottom: 0px;">Tótens Cadastrados</h1>
                <button onclick="abrirPopupTotem()">Adicionar Tótem</button>
            </div>
            <div class="pendentes" id="div_pendentes" style="height: 450px;">
            </div>
        </div>
    </div>

    <!-- style="display: none;" -->
    <div class="popuptotem" id="popuptotem" style="display: none;">
        <div class="card">
            <div class="cima">
                <h1>Cadastro de Tótem</h1>
                <button onclick="fecharPopupTotem()"><img src="assets/imgs/close.png"></button>
            </div>
            <div class="baixo" id="baixo">
                <div class="part-dois">
                    <div class="item-card">
                        <label for="input_cep">Cep:</label>
                        <input type="text" id="input_cep" maxlength="8" oninput="buscarCEP()">
                    </div>
                    <div class="item-card">
                        <label>Estado:</label>
                        <label id="estado"></label>
                    </div>
                    <div class="item-card">
                        <label>Estado:</label>
                        <label id="estado"></label>
                    </div>
                    <div class="item-card">
                        <label>Cidade:</label>
                        <label id="cidade"></label>
                    </div>
                </div>
                <div class="part-dois">
                    <div class="item-card">
                        <label>Bairro:</label>
                        <label id="bairro"></label>
                    </div>
                    <div class="item-card">
                        <label>Rua:</label>
                        <label id="rua"></label>
                    </div>
                </div>
                <div class="part-dois">
                    <div class="item-card">
                        <label for="input_numero">Número:</label>
                        <input type="number" id="input_numero">
                    </div>
                    <div class="item-card">
                        <label for="input_complemento">Complemento:</label>
                        <input type="text" id="input_complemento">
                    </div>
                </div>
                <div class="part-dois">
                    <div class="item-card">
                        <label for="input_qtd_de_totens">Quantos tótens nesse local?</label>
                        <input type="number" id="input_qtd_de_totens" oninput="adicionarTotem()">
                    </div>
                    <div class="item-card">
                        <label for="vies">Qual o viés?</label>
                        <select name="vies" id="input_vies">
                            <option value="">Escolha uma opção</option>
                            <option value="Centro">Fast-Food</option>
                            <option value="Norte">Roupa</option>
                            <option value="Sul">Hospital</option>
                        </select>
                    </div>
                    <div class="item-card">
                        <label for="input_modelo">Qual o modelo?</label>
                        <select name="modelos" id="input_modelos">
                            <option value="">Selecione uma opção</option>
                        </select>
                    </div>
                </div>
                <div class="item-card" id="totens"></div>
                <div class="part-dois">
                    <button class="cadastrar" onclick="adicionarTotem()">Adicionar Tótem</button>
                    <button class="cadastrar" onclick="cadastrarTotem()">Cadastrar</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>

    function adicionarTotem() {
        const qtdTotens = Number(document.getElementById("input_qtd_de_totens").value);
        const container = document.getElementById("totens");

        container.innerHTML = "";

        for (let i = 0; i < qtdTotens; i++) {
            const novoInput = document.createElement("input");
            novoInput.type = "text";
            novoInput.placeholder = `MAC ADDRESS`;
            novoInput.style.display = "block";
            novoInput.style.margin = "8px 0";

            container.appendChild(novoInput);
        }
    }

    function abrirPopupTotem() {
        var options = ''
        for (var i = 0; i < modelos.length; i++) {
            options += `<option value='${modelos[i].IdModelo}'>${modelos[i].Nome}</option>`
        }

        input_modelos.innerHTML += options

        document.getElementById("popuptotem").style.display = "flex";
    }

    function fecharPopupTotem() {
        document.getElementById("popuptotem").style.display = "none";
        window.location.reload();
    }

    var modelos = []
    function carregarDadosModelo() {
        idEmpresa = sessionStorage.getItem("ID_EMPRESA");

        fetch("/modelo/buscarModelos", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                fkEmpresaServer: idEmpresa
            }),
        })
            .then(resposta => {
                if (resposta.ok) {
                    return resposta.json();
                } else {
                    throw new Error("Erro na resposta do servidor");
                }
            })
            .then(dados => {
                for (let i = 0; i < dados.length; i++) {
                    modelos.push(dados[i]);
                }
            })
            .catch(erro => {
                console.log(`#ERRO: ${erro}`);
            });
    }

    async function buscarCEP() {
        let cepDigitado = input_cep.value;

        let retornoConvertido =
            await fetch(`https://viacep.com.br/ws/${cepDigitado}/json/`)
                .then((resposta) => resposta.json())

        console.log("Resposta final: ", retornoConvertido);
        estado.innerHTML = `${retornoConvertido.estado}`
        cidade.innerHTML = `${retornoConvertido.localidade}`
        bairro.innerHTML = `${retornoConvertido.bairro}`
        rua.innerHTML = `${retornoConvertido.logradouro}`
    }
</script>

</html>