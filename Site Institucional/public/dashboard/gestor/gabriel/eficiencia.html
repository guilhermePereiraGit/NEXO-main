<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Página de Cadastros de Totens</title>
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="stylesheet" href="eficiencia.css">
</head>

<body onload="carregarDados()">

  <div class="container">
    <div class="nav-bar">
      <div class="sair" style="margin-top: 40px;">
        <div class="fundo" style="display: none;"></div>

        <i class="bi bi-box-arrow-left" onclick="ativarPopup()" style="color: white; cursor: pointer;"></i>
      </div>
    </div>

    <div class="main">
      <div class="topo">
        <h2 style="margin-left: 70px;">Modelos Cadastrados</h2>
        <button onclick="abrirPopupModelo()" style="margin-right: 70px;">Adicionar Modelo</button>
      </div>

      <div class="baixo">
        <div class="conteudo">
          <div class="div_kpis" id="div_kpis">
            <div id="total_tecnicos_associados" class="kpi">
              <div class="kpi-cima">
                <h2>Total de Técnicos Associados</h2>
                <p>da Região</p>
              </div>
              <div class="kpi-baixo">
                <h3 id="total_tecnicos"></h3>
                <p><span id="comparacao"></span>% do total</p>
              </div>
            </div>
            <div id="capacidade_operacional" class="kpi">
              <div id="kpi-cima">
                <h2>Capacidade Operacional</h2>
              </div>
              <div id="kpi-baixo-capacidade-operacional">
                <div id="horas_ideais">
                  <h3>Horas Ideais</h3>
                  <p id="qtd_horas_ideais">588</p>
                </div>
                <div id="horas_trabalhadas">
                  <h3>Horas Trabalhadas</h3>
                  <p id="qtd_horas_trabalhadas">1000</p>
                </div>
              </div>
            </div>
            <div id="quantidade_tecnicos_recomendada" class="kpi">
              <div class="kpi-cima">
                <h2>Quantidade de Técnicos<br>Recomendada</h2>
                <p>para a Região</p>
              </div>
              <div class="kpi-baixo">
                <h3 id="qtd_recomendada"></h3>
              </div>
            </div>
          </div>
          <div class="graficos">
            <div id="chart">
              <div id="timeline-chart"></div>
            </div>
            <div class="tabela">
              <div id="titulo-tabela">
                <h2>Capacidade Operacional por Região</h2>
              </div>
              <div id="categorias">
                <h2>Região</h2>
                <h2>H. Ideais</h2>
                <h2>H. Trabalhadas</h2>
              </div>
              <div id="conteudo-tabela">
                <div class="linha-tabela">
                  <p>São Paulo</p>
                  <p>700</p>
                  <p style="color: #DC2626;">1050</p>
                </div>
                <div class="linha-tabela">
                  <p>Campinas</p>
                  <p>670</p>
                  <p style="color: #DC2626;">720</p>
                </div>
                <div class="linha-tabela">
                  <p>São Bernardo</p>
                  <p>530</p>
                  <p style="color: #10B981;">500</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>

<script>
  async function carregarDados() {

    const idEmpresa = sessionStorage.FK_EMPRESA;
    const regiao = ""
    const dataAtual = new Date();
    const dia = String(dataAtual.getDate()).padStart(2, '0');
    const mes = String(dataAtual.getMonth() + 1).padStart(2, '0');
    const ano = dataAtual.getFullYear();

    const dataFormatada = `${dia}-${mes}-${ano}`;

    const resposta = await fetch(`/1/23-11-25/`);
    const data = await resposta.json();

    plotarDados(data, idEmpresa, idRegiao)
  }

  function plotarDados(data, idEmpresa, idRegiao){

    for(var i = 0; i < data.length; i++){
      if(data.totalTecnicos[0].regiao == regiao){
        total_tecnicos.innerHTML = data.totalTecnicos[i].qtdTecnicos;
        comparacao.innerHTML = Math.round(data.comparacao[i].percentual, 1);
      }
    }

    qtd_horas_ideais.innerHTML = 
    qtd_horas_trabalhadas.innerHTML = 
    qtd_recomendada.innerHTML = data.t
  }

  var options = {
    series: [
      {
        name: 'Actual',
        data: [
          {
            x: '01/11',
            y: 890,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          },
          {
            x: '08/11',
            y: 924,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          },
          {
            x: '15/11',
            y: 680,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          },
          {
            x: '22/11',
            y: 876,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          }
        ]
      }
    ],
    chart: {
      height: 350,
      type: 'bar'
    },
    plotOptions: {
      bar: {
        columnWidth: '60%'
      }
    },
    colors: ['#00E396'],
    dataLabels: {
      enabled: false
    },
    legend: {
      show: true,
      showForSingleSeries: true,
      customLegendItems: ['Horas Trabalhadas', 'Horas Ideais'],
      markers: {
        fillColors: ['#00E396', '#775DD0']
      }
    }
  };

  var chart = new ApexCharts(document.querySelector("#chart"), options);
  chart.render();

</script>

</html>