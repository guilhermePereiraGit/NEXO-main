<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Página de Cadastros de Totens</title>
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="stylesheet" href="eficiencia.css">
</head>

<body onload="carregarDados()">

  <div class="container">
    <div class="header-container">
      <!-- MENU -->
      <div class="header-menu">
        <div class="menu" id="menu" onclick="abrirMenu()">
          <i class="bi bi-list" id="icone"></i>
        </div>
      </div>

      <!-- NAVEGAÇÃO -->
      <div class="header-navigation">
        <div class="home">
          <div class="fundo" style="display: none;"></div>
          <i class="bi bi-house" onclick="window.location.href = '../../../gestor.html'"></i>
        </div>
        <div class="eficiencia">
          <div class="fundo" id="fundo2" style="display: block;"></div>
          <i class="bi bi-eye" style="color: #451c8b;"></i>
        </div>
        <div class="eficiencia">
          <div class="fundo" id="fundo2" style="display: none;"></div>
          <i class="bi bi-clipboard-data" onclick="window.location.href = '../gabriel/eficiencia.html'" id="third"></i>
        </div>
        <div class="sair">
          <div class="fundo" style="display: none;"></div>
          <i class="bi bi-box-arrow-left" onclick="ativarPopup()"></i>
        </div>
      </div>
      <!-- HELP - MÉTRICAS -->
      <div class="header-help"></div>
      <div class="menu-extend" style="display: none;" id="extend">
        <div class="infos-user">
          <h1 id="nome_user"></h1>
          <h2>Gestor de Operações</h2>
        </div>
        <div class="widgets">
          <p>Caso se depare com algum problema, entre em contato via:</p>
          <div class="email" style="margin-top: 20px;">
            <i class="bi bi-envelope"></i>
            <p>Email: nexoadm9328@outlook.com</p>
          </div>
          <div class="telefone" style="margin-top: 20px;">
            <i class="bi bi-telephone"></i>
            <p>Telefone: +55(11)98802-2449</p>
          </div>
        </div>
        <div class="jira-slack">
          <div class="card"
            onclick="window.location.href = 'https://nexoadm.atlassian.net/jira/servicedesk/projects/NEXO/summary?ignoreStickyVersion=true'">
            <img src="../../../assets/imgs/icon-jira.png">
            <h1>Jira</h1>
          </div>
          <div class="card" onclick="window.location.href = 'https://app.slack.com/client/T09LFRM7PFX/C09LH8XJS22'">
            <img src="../../../assets/imgs/icon-slack.png">
            <h1>Slack</h1>
          </div>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="information">
        <div class="information-first">
          <div class="title">
            <h1 id="regiao-escolhida"></h1>
            <p id="sigla-regiao"></p>
          </div>
          <div class="alterar-regiao">
            <i class="bi bi-arrow-repeat" onclick="abrirEscolha()" id="escolhaNew"></i>
          </div>
        </div>
        <div class="interval">
          <h1>Últimos 7 Dias</h1>
          <p id="p_data"></p>
        </div>
      </div>

      <div class="baixo">
        <div class="conteudo">
          <div class="div_kpis" id="div_kpis">
            <div id="total_tecnicos_associados" class="kpi">
              <div class="kpi-cima">
                <h2>Total de Técnicos Associados</h2>
                <p>da Região</p>
              </div>
              <div class="kpi-baixo">
                <h3 id="total_tecnicos"></h3>
                <p><span id="comparacao"></span>% do total</p>
              </div>
            </div>
            <div id="capacidade_operacional" class="kpi">
              <div id="kpi-cima">
                <h2>Capacidade Operacional</h2>
              </div>
              <div id="kpi-baixo-capacidade-operacional">
                <div id="horas_ideais">
                  <h3>Horas Ideais</h3>
                  <p id="qtd_horas_ideais">588</p>
                </div>
                <div id="horas_trabalhadas">
                  <h3>Horas Trabalhadas</h3>
                  <p id="qtd_horas_trabalhadas">1000</p>
                </div>
              </div>
            </div>
            <div id="quantidade_tecnicos_recomendada" class="kpi">
              <div class="kpi-cima">
                <h2>Quantidade de Técnicos<br>Recomendada</h2>
                <p>para a Região</p>
              </div>
              <div class="kpi-baixo">
                <h3 id="qtd_recomendada"></h3>
              </div>
            </div>
          </div>
          <div class="graficos">
            <div id="chart">
              <div id="timeline-chart"></div>
            </div>
            <div class="tabela">
              <div id="titulo-tabela">
                <h2>Capacidade Operacional por Região</h2>
              </div>
              <div id="categorias">
                <h2>Região</h2>
                <h2>H. Ideais</h2>
                <h2>H. Trabalhadas</h2>
              </div>
              <div id="conteudo_tabela"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</body>

<script>

  function abrirMenu() {
    menu_icon = document.getElementById('icone');
    menu = document.querySelector('.menu-extend');
    if (menu_icon.classList.contains("bi-list")) {
      document.getElementById('extend').style.display = "flex";
      menu.style.animation = "expandirDireita 0.5s ease forwards";
      menu_icon.classList.remove("bi-list");
      menu_icon.classList.add("bi-x-lg")

    } else {
      menu.style.animation = "recolherEsquerda 0.5s ease forwards";
      menu_icon.classList.remove("bi-x-lg");
      menu_icon.classList.add("bi-list")
    }
  }

  async function carregarDados() {

    const idEmpresa = sessionStorage.FK_EMPRESA;
    const regiao = ""
    const dataAtual = new Date();
    const dia = String(dataAtual.getDate()).padStart(2, '0');
    const mes = String(dataAtual.getMonth() + 1).padStart(2, '0');
    const ano = dataAtual.getFullYear();

    const dataFormatada = `${dia}-${mes}-${ano}`;

    const resposta = await fetch(`/s3Route/${idEmpresa}/23-11-25`);
    const data = await resposta.json();

    console.log(data)

    plotarDados(data, idEmpresa, regiao)
  }

  function plotarDados(data, idEmpresa, regiao) {

    total_tecnicos.innerHTML = data.totalTecnicos[0].qtdTecnicos;
    comparacao.innerHTML = Math.round(data.comparacao[0].percentual, 1);

    var horasIdeais = data.horasIdeais[0].horasIdeais;

    qtd_horas_ideais.innerHTML = horasIdeais; 

    var duracao = Math.round((data.horasTrabalhadas[0].duracao / 60) / 60, 2);

    if(duracao <= horasIdeais){
      qtd_horas_trabalhadas.innerHTML = `<p  style="color: green;">${duracao}</p>`;
    }else{
      qtd_horas_trabalhadas.innerHTML = `<p  style="color: green;">${duracao}</p>`;
    }

    qtd_recomendada.innerHTML = data.qtdRecomendadaDeFuncionarios[0].qtdRecomendada;

    var conteudo = ``

    for (var i = 0; i < data.horasIdeais.length; i++) {
      var item = data.horasIdeais[i];

      conteudo_tabela.innerHTML += `
        <div class="linha-tabela">
          <p>${item.regiao}</p>
          <p>${item.horasIdeais}</p>
          <p style="color: #DC2626;">1050</p>
        </div>
      `;
    }
  }

  var options = {
    series: [
      {
        name: 'Actual',
        data: [
          {
            x: '01/11',
            y: 890,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          },
          {
            x: '08/11',
            y: 924,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          },
          {
            x: '15/11',
            y: 680,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          },
          {
            x: '22/11',
            y: 876,
            goals: [
              {
                name: 'Expected',
                value: 700,
                strokeHeight: 5,
                strokeColor: '#775DD0'
              }
            ]
          }
        ]
      }
    ],
    chart: {
      height: 350,
      type: 'bar'
    },
    plotOptions: {
      bar: {
        columnWidth: '60%'
      }
    },
    colors: ['#00E396'],
    dataLabels: {
      enabled: false
    },
    legend: {
      show: true,
      showForSingleSeries: true,
      customLegendItems: ['Horas Trabalhadas', 'Horas Ideais'],
      markers: {
        fillColors: ['#00E396', '#775DD0']
      }
    }
  };

  var chart = new ApexCharts(document.querySelector("#chart"), options);
  chart.render();

</script>

</html>